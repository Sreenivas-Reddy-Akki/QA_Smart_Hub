<header class="bg-secondary shadow-lg fixed top-0 w-full z-50 fixed-header-z-fix" id="site-header">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">

            <div class="flex items-end space-x-2">
                <a href="{{ url_for('home') }}" class="flex-shrink-0 text-2xl font-bold text-indigo-700 tracking-wide">
                    QA<span class="text-text-light">SmartHub</span>
                </a>
                <span class="text-xs text-text-muted font-mono pb-0.5 hidden sm:block">v1.0.0</span>
            </div>

            <div class="hidden sm:flex sm:items-center">
                {% if session.logged_in %}
                {% set current_endpoint = request.endpoint if request else '' %}
                {% set is_automation_active = current_endpoint.startswith('automation_') or current_endpoint.startswith('selenium_') or current_endpoint.startswith('python_') or current_endpoint.startswith('java_') %}

                <div class="flex items-center space-x-4">

                    <!-- Use an anchor tag to enable navigation -->
                    <a href="/akki_ai"
                       class="text-primary hover:bg-indigo-700 px-3 py-2 rounded-md text-sm font-bold transition duration-150 flex items-center border border-primary/50 shadow-sm whitespace-nowrap">
                       <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                       Akki AI
                    </a>

                    <a href="{{ url_for('home') }}"
                       class="{% if current_endpoint == 'home' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">Home</a>

                    <a href="{{ url_for('manual') }}"
                       class="{% if current_endpoint == 'manual' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">Manual</a>

                    <div class="relative group">
                        <a href="{{ url_for('automation_home') }}"
                            class="{% if is_automation_active %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150 flex items-center">
                            Automation <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </a>

                        <div class="absolute left-0 hidden group-hover:block bg-secondary text-text-light rounded-md shadow-xl mt-0 w-64 z-50 border border-gray-700/50 max-h-96 overflow-y-auto">

                            <div class="px-4 pt-2 pb-1 text-xs font-semibold text-primary/70 uppercase tracking-wider">Learning Levels</div>
                            <a href="{{ url_for('automation_beginners') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_beginners' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Beginners</a>
                            <a href="{{ url_for('automation_intermediate') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_intermediate' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Intermediate</a>
                            <a href="{{ url_for('automation_professional') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_professional' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Advanced</a>

                            <div class="border-t border-gray-700/50 my-1"></div>

                            <div class="px-4 pt-2 pb-1 text-xs font-semibold text-primary/70 uppercase tracking-wider">Languages & Frameworks</div>

                            {% set is_selenium_active = current_endpoint.startswith('selenium_') or current_endpoint == 'automation_selenium' %}
                            <a href="{{ url_for('automation_selenium') }}" class="block px-4 py-1 text-sm font-medium transition duration-100 {% if is_selenium_active %}bg-gray-700/50 text-text-light{% else %}hover:bg-gray-700/70 text-text-light{% endif %}">Selenium (WebDriver)</a>
                            <a href="{{ url_for('selenium_beginner') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'selenium_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Beginner Level</a>
                            <a href="{{ url_for('selenium_intermediate') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'selenium_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Intermediate Level</a>
                            <a href="{{ url_for('selenium_advanced') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'selenium_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Advanced Level</a>

                            {% set is_python_active = current_endpoint.startswith('python_') or current_endpoint == 'automation_python' %}
                            <a href="{{ url_for('automation_python') }}" class="block px-4 pt-2 pb-1 text-sm font-medium transition duration-100 {% if is_python_active %}bg-gray-700/50 text-text-light{% else %}hover:bg-gray-700/70 text-text-light{% endif %}">Python Programming</a>
                            <a href="{{ url_for('python_beginner') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'python_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Beginner Level</a>
                            <a href="{{ url_for('python_intermediate') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'python_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Intermediate Level</a>
                            <a href="{{ url_for('python_advanced') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'python_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Advanced Level</a>

                            {% set is_java_active = current_endpoint.startswith('java_') or current_endpoint == 'automation_java' %}
                            <a href="{{ url_for('automation_java') }}" class="block px-4 pt-2 pb-1 text-sm font-medium transition duration-100 {% if is_java_active %}bg-gray-700/50 text-text-light{% else %}hover:bg-gray-700/70 text-text-light{% endif %}">Java Programming</a>
                            <a href="{{ url_for('java_beginner') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'java_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Beginner Level</a>
                            <a href="{{ url_for('java_intermediate') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'java_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Intermediate Level</a>
                            <a href="{{ url_for('java_advanced') }}" class="block pl-8 pr-4 py-1 text-xs transition duration-100 {% if current_endpoint == 'java_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/70{% endif %}">Advanced Level</a>

                            <a href="{{ url_for('automation_playwright') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_playwright' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Playwright</a>
                            <a href="{{ url_for('automation_rest_assured') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_rest_assured' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Rest Assured (API)</a>

                            <div class="border-t border-gray-700/50 my-1"></div>

                            <div class="px-4 pt-2 pb-1 text-xs font-semibold text-primary/70 uppercase tracking-wider">Tools & Ecosystem</div>
                            <a href="{{ url_for('automation_pytest') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_pytest' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Pytest</a>
                            <a href="{{ url_for('automation_testng') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_testng' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">TestNG</a>
                            <a href="{{ url_for('automation_cucumber') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_cucumber' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Cucumber (BDD)</a>
                            <a href="{{ url_for('automation_postman') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_postman' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Postman (API Testing)</a>
                            <a href="{{ url_for('automation_xpath') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_xpath' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">XPath</a>
                            <a href="{{ url_for('automation_maven') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_maven' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Maven</a>
                            <a href="{{ url_for('automation_frameworks') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_frameworks' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Framework Concepts</a>
                            <a href="{{ url_for('automation_git') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_git' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Git & GitHub</a>
                            <a href="{{ url_for('automation_docker') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_docker' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Docker</a>
                            <a href="{{ url_for('automation_jenkins') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_jenkins' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Jenkins</a>
                            <a href="{{ url_for('automation_ci_cd') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_ci_cd' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">CI/CD Pipeline</a>
                            <a href="{{ url_for('automation_allure') }}" class="block px-4 py-2 text-sm transition duration-100 {% if current_endpoint == 'automation_allure' %}bg-primary/20 hover:bg-primary/30 text-primary font-semibold{% else %}hover:bg-gray-700/70{% endif %}">Allure Reports</a>
                        </div>
                    </div>

                    <a href="{{ url_for('ai_tools') }}"
                       class="{% if current_endpoint == 'ai_tools' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">AI Tools</a>
                    <a href="{{ url_for('interview') }}"
                       class="{% if current_endpoint == 'interview' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">Interview Prep</a>
                    <a href="{{ url_for('blog') }}"
                       class="{% if current_endpoint == 'blog' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">Videos Hub</a>
                    <a href="{{ url_for('about') }}"
                       class="{% if current_endpoint == 'about' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} px-3 py-2 rounded-md text-sm font-medium transition duration-150">About</a>
                </div>
                {% endif %}
            </div>

            <div class="flex items-center">
                {% if session.logged_in %}
                <div class="hidden sm:block relative">
                    <button id="user-menu-button" type="button" class="max-w-xs bg-gray-800 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-primary p-1" aria-expanded="false" aria-haspopup="true">
                        <span class="sr-only">Open user menu</span>
                        <svg class="h-6 w-6 text-text-light" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </button>

                    <div id="user-menu" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-secondary ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                        <div class="px-4 py-2 text-sm text-text-muted border-b border-gray-700">Settings</div>

                        <button id="theme-switcher-desktop" class="w-full text-left px-4 py-2 text-sm text-text-light hover:bg-gray-700 transition duration-150" role="menuitem" tabindex="-1">
                            <span id="theme-text-desktop">Switch Theme</span>
                        </button>

                        <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-red-400 hover:bg-gray-700 transition duration-150" role="menuitem" tabindex="-1">
                            Sign out
                        </a>
                    </div>
                </div>
                {% else %}
                <a href="{{ url_for('login') }}" class="ml-10 hidden sm:block text-white bg-primary hover:bg-indigo-500 px-3 py-2 rounded-md text-sm font-medium transition duration-150 shadow-md">Sign In</a>
                {% endif %}

                <div class="-mr-2 flex sm:hidden">
                    <button id="mobile-menu-button" type="button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-text-muted hover:text-text-light hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-primary" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="sm:hidden hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            {% if session.logged_in %}

            <a href="#" class="text-primary bg-gray-800 hover:bg-gray-700 hover:text-text-light block px-3 py-2 rounded-md text-base font-medium transition duration-150 flex items-center">
                <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                Akki AI Chatbot
            </a>

            <a href="{{ url_for('home') }}"
               class="{% if current_endpoint == 'home' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">Home</a>
            <a href="{{ url_for('manual') }}"
               class="{% if current_endpoint == 'manual' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">Manual Testing</a>

            <a href="{{ url_for('automation_home') }}"
               class="{% if is_automation_active %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">Automation Topics</a>

            <div class="ml-4 space-y-1 py-1 border-l-2 border-primary max-h-96 overflow-y-auto">

                <div class="px-3 pt-2 text-xs font-semibold text-primary/70 uppercase tracking-wider">Learning Levels</div>
                <a href="{{ url_for('automation_beginners') }}" class="{% if current_endpoint == 'automation_beginners' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Beginners Level</a>
                <a href="{{ url_for('automation_intermediate') }}" class="{% if current_endpoint == 'automation_intermediate' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Intermediate Level</a>
                <a href="{{ url_for('automation_professional') }}" class="{% if current_endpoint == 'automation_professional' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Professional Level</a>

                <div class="border-t border-gray-700 my-1"></div>

                <div class="px-3 pt-2 text-xs font-semibold text-primary/70 uppercase tracking-wider">Languages & Frameworks</div>

                <a href="{{ url_for('automation_selenium') }}" class="{% if is_selenium_active %}bg-gray-700/50 text-text-light{% else %}text-text-light hover:bg-gray-700/50{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Selenium (WebDriver)</a>
                <a href="{{ url_for('selenium_beginner') }}" class="{% if current_endpoint == 'selenium_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Beginner</a>
                <a href="{{ url_for('selenium_intermediate') }}" class="{% if current_endpoint == 'selenium_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Intermediate</a>
                <a href="{{ url_for('selenium_advanced') }}" class="{% if current_endpoint == 'selenium_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Advanced</a>

                <a href="{{ url_for('automation_python') }}" class="{% if is_python_active %}bg-gray-700/50 text-text-light{% else %}text-text-light hover:bg-gray-700/50{% endif %} block px-3 py-1 rounded-md text-sm font-medium mt-1">Python Programming</a>
                <a href="{{ url_for('python_beginner') }}" class="{% if current_endpoint == 'python_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Beginner</a>
                <a href="{{ url_for('python_intermediate') }}" class="{% if current_endpoint == 'python_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Intermediate</a>
                <a href="{{ url_for('python_advanced') }}" class="{% if current_endpoint == 'python_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Advanced</a>

                <a href="{{ url_for('automation_java') }}" class="{% if is_java_active %}bg-gray-700/50 text-text-light{% else %}text-text-light hover:bg-gray-700/50{% endif %} block px-3 py-1 rounded-md text-sm font-medium mt-1">Java Programming</a>
                <a href="{{ url_for('java_beginner') }}" class="{% if current_endpoint == 'java_beginner' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Beginner</a>
                <a href="{{ url_for('java_intermediate') }}" class="{% if current_endpoint == 'java_intermediate' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Intermediate</a>
                <a href="{{ url_for('java_advanced') }}" class="{% if current_endpoint == 'java_advanced' %}bg-primary/10 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-800/50{% endif %} block px-6 py-1 rounded-md text-xs font-medium"> - Advanced</a>

                <a href="{{ url_for('automation_playwright') }}" class="{% if current_endpoint == 'automation_playwright' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium mt-1">Playwright</a>
                <a href="{{ url_for('automation_rest_assured') }}" class="{% if current_endpoint == 'automation_rest_assured' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Rest Assured (API)</a>


                <div class="border-t border-gray-700 my-1"></div>

                <div class="px-3 pt-2 text-xs font-semibold text-primary/70 uppercase tracking-wider">Tools & Ecosystem</div>
                <a href="{{ url_for('automation_pytest') }}" class="{% if current_endpoint == 'automation_pytest' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Pytest</a>
                <a href="{{ url_for('automation_testng') }}" class="{% if current_endpoint == 'automation_testng' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">TestNG</a>
                <a href="{{ url_for('automation_cucumber') }}" class="{% if current_endpoint == 'automation_cucumber' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Cucumber (BDD)</a>
                <a href="{{ url_for('automation_postman') }}" class="{% if current_endpoint == 'automation_postman' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Postman (API Testing)</a>
                <a href="{{ url_for('automation_xpath') }}" class="{% if current_endpoint == 'automation_xpath' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">XPath</a>
                <a href="{{ url_for('automation_maven') }}" class="{% if current_endpoint == 'automation_maven' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Maven</a>
                <a href="{{ url_for('automation_frameworks') }}" class="{% if current_endpoint == 'automation_frameworks' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Framework Concepts</a>
                <a href="{{ url_for('automation_git') }}" class="{% if current_endpoint == 'automation_git' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Git & GitHub</a>
                <a href="{{ url_for('automation_docker') }}" class="{% if current_endpoint == 'automation_docker' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Docker</a>
                <a href="{{ url_for('automation_jenkins') }}" class="{% if current_endpoint == 'automation_jenkins' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Jenkins</a>
                <a href="{{ url_for('automation_ci_cd') }}" class="{% if current_endpoint == 'automation_ci_cd' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">CI/CD Pipeline</a>
                <a href="{{ url_for('automation_allure') }}" class="{% if current_endpoint == 'automation_allure' %}bg-primary/20 text-primary font-semibold{% else %}text-text-muted hover:bg-gray-700/50 hover:text-text-light{% endif %} block px-3 py-1 rounded-md text-sm font-medium">Allure Reports</a>
            </div>

            <a href="{{ url_for('ai_tools') }}" class="{% if current_endpoint == 'ai_tools' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">AI Tools</a>
            <a href="{{ url_for('interview') }}" class="{% if current_endpoint == 'interview' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">Interview Prep</a>
            <a href="{{ url_for('blog') }}" class="{% if current_endpoint == 'blog' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">Blog</a>
            <a href="{{ url_for('about') }}" class="{% if current_endpoint == 'about' %}bg-gray-700 text-text-light{% else %}text-text-muted hover:bg-gray-700 hover:text-text-light{% endif %} block px-3 py-2 rounded-md text-base font-medium">About</a>

            <button onclick="toggleTheme()" class="w-full text-left text-text-light hover:bg-gray-700 block px-3 py-2 rounded-md text-base font-medium">
                <span id="theme-text-mobile">Switch Theme</span>
            </button>

            <a href="{{ url_for('logout') }}" class="text-white bg-red-600 hover:bg-red-700 block px-3 py-2 rounded-md text-base font-medium mt-2">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="text-white bg-primary hover:bg-indigo-500 block px-3 py-2 rounded-md text-base font-medium mt-2">Sign In</a>
            {% endif %}
        </div>
    </div>
</header>

<script>
    // Note: THEME_KEY must be defined in your base.html head (e.g., const THEME_KEY = 'theme';)

    // Safe query helpers
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    // Theme functions
    function applyTheme(theme) {
        const isDark = theme === 'dark';
        const html = document.documentElement;
        const body = document.body;

        // Apply body theme class
        body.classList.toggle('light-theme', !isDark);

        // Apply global background for minimal flash
        html.classList.toggle('bg-gray-900', isDark);
        html.classList.toggle('bg-gray-100', !isDark);

        // Update button text to reflect the *next* action
        const nextThemeText = isDark ? 'Switch to Light' : 'Switch to Dark';
        const desktopSpan = document.getElementById('theme-text-desktop');
        const mobileSpan = document.getElementById('theme-text-mobile');

        if (desktopSpan) desktopSpan.textContent = nextThemeText;
        if (mobileSpan) mobileSpan.textContent = nextThemeText;
    }

    function toggleTheme() {
        const currentTheme = localStorage.getItem(THEME_KEY) || 'dark';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        localStorage.setItem(THEME_KEY, newTheme);
        applyTheme(newTheme);

        // Close desktop user menu after selection
        const userMenu = document.getElementById('user-menu');
        if (userMenu) userMenu.classList.add('hidden');
    }

    // Header interactive logic
    document.addEventListener('DOMContentLoaded', function () {
        // 1) Initialize theme button text based on stored value
        let savedTheme = localStorage.getItem(THEME_KEY);
        if (!savedTheme || (savedTheme !== 'dark' && savedTheme !== 'light')) {
            savedTheme = 'dark';
        }
        applyTheme(savedTheme);

        // 2) Mobile menu toggle (safe-checks)
        const mobileToggle = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileToggle && mobileMenu) {
            mobileToggle.addEventListener('click', function () {
                const isOpen = !mobileMenu.classList.contains('hidden');
                mobileMenu.classList.toggle('hidden', isOpen);
                // swap icons inside the button if present
                const svgs = mobileToggle.querySelectorAll('svg');
                if (svgs.length >= 2) {
                    svgs[0].classList.toggle('hidden', !isOpen);
                    svgs[1].classList.toggle('hidden', isOpen);
                }
            });
        }

        // 3) Desktop user menu toggle (profile)
        const userMenuButton = document.getElementById('user-menu-button');
        const userMenu = document.getElementById('user-menu');
        if (userMenuButton && userMenu) {
            userMenuButton.addEventListener('click', function (event) {
                event.stopPropagation();
                userMenu.classList.toggle('hidden');
                const isExpanded = !userMenu.classList.contains('hidden');
                userMenuButton.setAttribute('aria-expanded', isExpanded);
            });
        }

        // 4) Theme switcher inside desktop user menu
        const themeSwitcherDesktop = document.getElementById('theme-switcher-desktop');
        if (themeSwitcherDesktop) {
            themeSwitcherDesktop.addEventListener('click', function () {
                toggleTheme();
            });
        }

        // 5) Close user menu when clicking outside
        document.addEventListener('click', function (event) {
            const umb = document.getElementById('user-menu-button');
            const um = document.getElementById('user-menu');
            if (umb && um) {
                const isClickInsideButton = umb.contains(event.target);
                const isClickInsideMenu = um.contains(event.target);
                if (!isClickInsideButton && !isClickInsideMenu && !um.classList.contains('hidden')) {
                    um.classList.add('hidden');
                    umb.setAttribute('aria-expanded', false);
                }
            }
        });
    });
</script>